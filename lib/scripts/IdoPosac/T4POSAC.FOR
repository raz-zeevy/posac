

      SUBROUTINE SCORD (IPROF, IFREQ, IPRF, ISCO, NCAS2, NV)

C  ORDERS THE PROFILES ACCORDING TO THE DECREASING SCORES.
C  BUT OF COURSE FOR THE SAME SCORE THE ORDER OF THE
C  PROFILES IS RANDOM

      INTEGER*2 NCAS2,NV
      INTEGER*2 IPROF(NV),IFREQ(NCAS2),IPRF(NV,NCAS2),ISCO(NCAS2)
C
      COMMON/IO/NTAPE,NREAD,NWRITE,NSCR
      COMMON/CC/ISMN,ISMX,IEND
      COMMON/VARINT/INTERN
C
      INTEGER*2 ISMN,ISMX,IEND
C
      INTEGER*2 IS,I,J,K,IW
C
C **********************************************************************
C
      I=1
      IS=ISMX
   51 CONTINUE
      J=I
   31 CONTINUE
      IF(ISCO(J)-IS) 10,20,10
   10 IF(J-NCAS2) 30,40,30
   30 J=J+1
      GO TO 31
   40 IF(IS-ISMN) 50,62,50
   50 IS=IS-1
      GO TO 51
   20 IF(ISCO(I)+1) 70,80,70
   70 DO 90 K=1,INTERN
       IPROF(K)=IPRF(K,I)
       IPRF(K,I)=IPRF(K,J)
       IPRF(K,J)=IPROF(K)
   90 CONTINUE
      IW=ISCO(I)
      ISCO(I)=ISCO(J)
      ISCO(J)=IW
      IW=IFREQ(I)
      IFREQ(I)=IFREQ(J)
      IFREQ(J)=IW
      GO TO 100
   80 DO 91 K=1,INTERN
       IPRF(K,I)=IPRF(K,J)
   91 CONTINUE
      ISCO(I)=ISCO(J)
      IFREQ(I)=IFREQ(J)
      ISCO(J)=-1
  100 IF(I-NCAS2) 110,60,110
  110 IEND=I
      I=I+1
      GO TO 10
   60 IEND=I
   62 CONTINUE
      WRITE(NWRITE,250) IEND
  250 FORMAT(//,10H THERE ARE,I4,19H DIFFERENT PROFILES)
C
      RETURN
C
      END

      SUBROUTINE COMPAR (IFREQ, IPRF, ISCO, ICOMP,
     $                      NV, IEND, NCAS2)

      COMMON/IO/NTAPE,NREAD,NWRITE,NSCR
      COMMON/TEST/ITESTN,ITESTX
      COMMON/VARINT/INTERN
      COMMON /WCHAR/ FMT20,FMT21,FMT22,FMT23,FMT24,FMT25,FMT26,
     $               FMT40,FMT41,FMT42,FMT43,FMT44,FMT45,FMT46,
     $               FMT30,FMT31,FMT32,FMT33,DUMMY

C
      INTEGER*2 NV, IEND, NCAS2
      INTEGER*2 IFREQ(NCAS2),IPRF(NV,NCAS2),ISCO(NCAS2),ICOMP(NCAS2)
C
      CHARACTER FMT20*92,FMT21*7,FMT22*7,FMT23*3,FMT24*3,FMT25*2,
     $    FMT26*70
      CHARACTER FMT40*80,FMT41*7,FMT42*7,FMT43*3,FMT44*3,FMT45*2,
     $    FMT46*58
      CHARACTER FMT30*27,FMT31*7,FMT32*7,FMT33*13
      CHARACTER*34 DUMMY
C
      INTEGER*2 I,J,IUP,IDOWN,ISC,IXX1,IXX2,K,IP
C
C **********************************************************************
C
C  INITIALIZING TWO VARIABLE FORMATS FOR PRINTING THE TABLE
C
      IF (INTERN .GT. 20) GOTO 90
      FMT21='(1X,I3,'
      FMT22='    2X,'
      WRITE (FMT23,'(I3)') INTERN
      FMT24='I2,'
      IXX1=(20-INTERN)*2+3
      WRITE (FMT25,'(I2)') IXX1
      FMT26='X,4HSCO= ,I3,3X,5HFREQ= ,I4,3X,22HGREATER THAN PROFILES:,'
     $         // '(T94,13I3))'
      FMT20=FMT21//FMT22//FMT23//FMT24//FMT25//FMT26
C
      FMT41='(1X,I3,'
      FMT42='    2X,'
      WRITE (FMT43,'(I3)') INTERN
      FMT44='I2,'
      IXX2=(20-INTERN)*2+3
      WRITE (FMT45,'(I2)') IXX2
      FMT46='X,4HSCO=,I3,3X,5HFREQ=,I4,3X,25HGREATER THAN PROFILES:  -)'
      FMT40=FMT41//FMT42//FMT43//FMT44//FMT45//FMT46
C
 90   CONTINUE
C
      FMT31='(1X,I3,'
      FMT32='    2X,'
      FMT33='(T1,6X,60I2))'
      FMT30=FMT31//FMT32//FMT33
C
C **********************************************************************
C
      IF (INTERN .LE. 20) THEN
          ASSIGN 2800 TO NVLE200
          ASSIGN 2801 TO NVLE201
          ASSIGN 2802 TO NVLE202
      ELSE
          ASSIGN 3800 TO NVLE200
          ASSIGN 3801 TO NVLE201
          ASSIGN 3802 TO NVLE202
      ENDIF
C
C **********************************************************************
C
C  FOR EACH PROFILE FINDS THOSE WHO ARE
C  UP-COMPARABLE AND DOWN-COMPARABLE
      WRITE(NWRITE,1500)
      I=1
   10 CONTINUE
      IDOWN=0
      IUP=0
      J=I+1
   20 CONTINUE
      IF(ISCO(I)-ISCO(J)) 30,40,30
   40 J=J+1
      GO TO 20
   30 ISC=ISCO(J)
   50 CONTINUE
      DO 60 K=1,INTERN
       IF(IPRF(K,I)-IPRF(K,J)) 70,60,60
   60 CONTINUE
      IDOWN=IDOWN+1
      ICOMP(IDOWN)=J
      IF(J.EQ.IEND) GO TO 80
   70 J=J+1
      IF(ISCO(J)-ISC) 81,50,81
   81 IF(IDOWN.EQ.0) GO TO 30
   80 IF(I.EQ.1) GO TO 800
      J=I-1
   25 CONTINUE
      IF(ISCO(I)-ISCO(J)) 35,45,35
   45 J=J-1
      GO TO 25
   35 ISC=ISCO(J)
   55 CONTINUE
      DO 65 K=1,INTERN
       IF(IPRF(K,I)-IPRF(K,J)) 65,65,75
   65 CONTINUE
      IUP=IUP+1
      ICOMP(IEND-IUP+1)=J
      IF(J.EQ.1) GO TO 800
   75 J=J-1
      IF(ISCO(J)-ISC) 860,55,860
  860 IF(IUP.EQ.0) GO TO 35
  800 IP=IEND-IUP+1
      IF(I.EQ.1) GO TO 801
      IF(I.EQ.IEND) GO TO 802
      GOTO NVLE200
2800  CONTINUE
      WRITE (NWRITE,FMT20) I,(IPRF(K,I),K=1,INTERN),
     $                     ISCO(I),IFREQ(I),(ICOMP(K),K=1,IDOWN)
      WRITE (NWRITE,2002) (ICOMP(K),K=IP,IEND)
      WRITE (NWRITE,*)
      GOTO 850
3800  CONTINUE
      WRITE (NWRITE,FMT30) I,(IPRF(K,I),K=1,INTERN)
      WRITE (NWRITE,3001) ISCO(I),IFREQ(I),(ICOMP(K),K=1,IDOWN)
      WRITE (NWRITE,3002) (ICOMP(K),K=IP,IEND)
      WRITE (NWRITE,*)
      GO TO 850
  801 CONTINUE
C
      GOTO NVLE201
C
2801  CONTINUE
      IF (ITESTX.EQ.0) THEN
          FMT22='1H*,1X,'
          FMT20=FMT21//FMT22//FMT23//FMT24//FMT25//FMT26
      ENDIF
C
      WRITE (NWRITE,FMT20) I,(IPRF(K,I),K=1,INTERN),
     $                      ISCO(I),IFREQ(I),(ICOMP(K),K=1,IDOWN)
C
      IF (ITESTX.EQ.0) THEN
          FMT22='    2X,'
          FMT20=FMT21//FMT22//FMT23//FMT24//FMT25//FMT26
      ENDIF
C
      WRITE (NWRITE,2022)
      WRITE (NWRITE,*)
      GOTO 850
C
 3801 CONTINUE
C
      IF (ITESTX.EQ.0) THEN
          FMT32='1H*,1X,'
          FMT30=FMT31//FMT32//FMT33
      ENDIF
C
      WRITE (NWRITE,FMT30) I,(IPRF(K,I),K=1,INTERN)
C
      IF (ITESTX.EQ.0) THEN
          FMT32='    2X,'
          FMT30=FMT31//FMT32//FMT33
      ENDIF
C
      WRITE (NWRITE,3001) ISCO(I),IFREQ(I),(ICOMP(K),K=1,IDOWN)
      WRITE (NWRITE,3022)
      WRITE (NWRITE,*)
      GO TO 850
C
  802 CONTINUE
      GOTO NVLE202
C
 2802 CONTINUE
C
      IF (ITESTN.EQ.0) THEN
          FMT42='1H*,1X,'
          FMT40=FMT41//FMT42//FMT43//FMT44//FMT45//FMT46
      ENDIF
C
      WRITE (NWRITE,FMT40) I,(IPRF(K,I),K=1,INTERN),ISCO(I),IFREQ(I)
C
      IF (ITESTN.EQ.0) THEN
          FMT42='    2X,'
          FMT40=FMT41//FMT42//FMT43//FMT44//FMT45//FMT46
      ENDIF
C
      WRITE (NWRITE,2002) (ICOMP(K),K=IP,IEND)
      WRITE (NWRITE,*)
      GOTO 850
C
 3802 CONTINUE
C
      IF (ITESTN.EQ.0) THEN
          FMT32='1H*,1X,'
          FMT30=FMT31//FMT32//FMT33
      ENDIF
C
      WRITE (NWRITE,FMT30) I,(IPRF(K,I),K=1,INTERN)
C
      IF (ITESTN.EQ.0) THEN
          FMT32='    2X,'
          FMT30=FMT31//FMT32//FMT33
      ENDIF
C
      WRITE (NWRITE,3041) ISCO(I),IFREQ(I)
      WRITE (NWRITE,3002) (ICOMP(K),K=IP,IEND)
      WRITE (NWRITE,*)
C
  850 CONTINUE
      I=I+1
      IF(I.EQ.IEND) GO TO 900
      IF(I.EQ.IEND+1) GO TO 950
      GO TO 10
  900 IDOWN=0
      J=IEND-1
      GO TO 25
  950 IF(ITESTN+ITESTX.LE.1) WRITE(NWRITE,1600)
C
      RETURN
C
2002  FORMAT(71X,'SMALLER THAN PROFILES:',(T94,13I3))
3001  FORMAT(1X,'SCO=',I3,3X,'FREQ=',I4,3X,'GREATER THAN PROFILES:',
     $                                      (T56,25I3) )
3002  FORMAT(33X,'SMALLER THAN PROFILES:',(T56,25I3) )
2022  FORMAT(71X,'SMALLER THAN PROFILES:  -')
3022  FORMAT(33X,'SMALLER THAN PROFILES:  -')
3041  FORMAT(1X,'SCO=',I3,3X,'FREQ=',I4,3X,'GREATER THAN PROFILES:  -')
1500  FORMAT(//,1X,3H ID,3X,7HPROFILE,/,2X,2H--,3X,7(1H-),/)
1600  FORMAT(///,37H    *EXTREME PROFILE ADDED BY PROGRAM    )
C
      END

      SUBROUTINE ONEFRQ (IFREQ, NCAS)
C
C         This subroutine sets the non-zero frequencies to unity,
C         to generate non-frequency-weighted calculation.
C
      INTEGER*2 NCAS
      INTEGER*2 IFREQ (NCAS)
C
      INTEGER*2 I
C
      DO 20 I = 1, NCAS
          IF (IFREQ (I) .GT. 1)  IFREQ (I) = 1
 20   CONTINUE
C
      RETURN
      END

