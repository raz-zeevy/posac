

      SUBROUTINE SEPAR (SOL,NP)

      INTEGER*2 NP
      REAL      SOL(NP,2)
C
      COMMON/IO/NTAPE,NREAD,NWRITE,NSCR
C
      INTEGER*2 NP1,K,K1,K2,ITEST
C
      NP1=NP-1
      ITEST=1
      DO 10 K1=1,NP1
          K=K1+1
          DO 11 K2=K,NP
               X1=SOL(K1,1)*.5+1.5
               Y1=SOL(K1,2)*.5+1.5
               X2=SOL(K2,1)*.5+1.5
               Y2=SOL(K2,2)*.5+1.5
               IF(INT(X1).NE.INT(X2).OR.INT(Y1).NE.INT(Y2)) GO TO 11
               IF(ITEST.EQ.1) WRITE(NWRITE,100)
               ITEST=0
               IF(X1.GT.X2.AND.Y1.GT.Y2) WRITE(NWRITE,200) K1,K2
               IF(X1.GT.X2.AND.Y1.LT.Y2) WRITE(NWRITE,300) K1,K2
               IF(X1.LT.X2.AND.Y1.GT.Y2) WRITE(NWRITE,400) K1,K2
               IF(X1.LT.X2.AND.Y1.LT.Y2) WRITE(NWRITE,500) K1,K2
   11     CONTINUE
   10 CONTINUE
C
      RETURN
C
  100 FORMAT(//,2X,29HLIST OF PROFILES WHICH DO NOT,
     $19H APPEAR ON THE PLOT,//,2X,13HID   LOCATION,
     $/,2X,2H--,3X,8(1H-),/)
  200 FORMAT(1X,I3,17H   NORTH-EAST OF ,I3)
  300 FORMAT(1X,I3,17H   SOUTH-EAST OF ,I3)
  400 FORMAT(1X,I3,17H   NORTH-WEST OF ,I3)
  500 FORMAT(1X,I3,17H   SOUTH-WEST OF ,I3)
C
      END

      SUBROUTINE PLPOSA(SOL,IPRF,IXY,ITEM,IPART,NV,N)

C  THIS SUB. PLOTS FOR SOLUTION SOL
C    IF ITEM=0 THE PROFILE ID (IPRF CAN BE DUMMY)
C    IF ITEM.NE.0 THE CATEGORY OF EACH PROFILE IN ITEM
C  IXY IS A WORKING AREA
C  THE INPUT COORDINATES SOL(.,1) (FIRST AXIS)
C  AND SOL(.,J) (SECOND AXIS) HAVE TO LIE
C  BETWEEN 0. AND 100.

      INTEGER*2 ITEM,IPART,NV,N
      INTEGER*2 IPRF(NV,N), IXY(N,2)
      REAL      SOL(N,2)
      INTEGER*2 IW(51)
C
      COMMON/IO/NTAPE,NREAD,NWRITE,NSCR
      COMMON/BOXSTRNG/UP,BOTTM,LEFT,RIGHT,
     $                UPLEFT,UPRIGHT,BOTTMLEFT,BOTTMRIGHT
      COMMON /WCHAR/ FOR,DUMMY
C
      CHARACTER*4 FOR(56)
      CHARACTER*208 DUMMY
      CHARACTER*1 UP,BOTTM,LEFT,RIGHT,
     $            UPLEFT,UPRIGHT,BOTTMLEFT,BOTTMRIGHT
      CHARACTER*4 F1,F56,F3,F55,SK8,BLANK,FALF,FINT
      CHARACTER*5 I100,I50,I0,IBL
      INTEGER*2   IBLANK, ISTAR
C
      INTEGER*2 K,NCOOR,NPOS,NFOR,LL,K3,KJ,IDP
C
      DATA F1,F56,F3,F55/4H(3X,     ,4H)       ,4H,A1     ,4H,A1     /
      DATA SK8/  4HA5         /
      DATA BLANK,FALF,FINT/4H        ,4H,A2   ,4H,I2      /
      DATA IBLANK,ISTAR/2H      ,2H *    /
      DATA I100,I50,I0,IBL/5H100.. ,5H 50..  ,5H  0..  ,5H       /
C
C **********************************************************************
C
C  THIS PLOT IS AVAILABLE FOR 51
C  POSITIONS IN EACH AXIS SINCE THE
C  COORDINATES GO FROM 0./2 TO 100./2
C
      NCOOR=50
      NPOS=NCOOR+1
      NFOR=3+NPOS+2
C
C  CLEAR FORMAT ARRAY
      DO 1 K=1,NFOR
          FOR(K)=BLANK
    1 CONTINUE
C
      FOR(1)=F1
      FOR(2)=SK8
      FOR(3)=F3
      FOR(NFOR-1)=F55
      FOR(NFOR)=F56
C
C  POINT COORDINATES ON FIRST AXIS
      DO 3 K=1,N
          IXY(K,1)=.5*SOL(K,1)+1.5
    3 CONTINUE
C
C  POINT COORDINATES ON SECOND AXIS
      DO 71 K=1,N
          LL=.5*SOL(K,2)+1.5
          IXY(K,2)=NPOS+1-LL
   71 CONTINUE
      WRITE(NWRITE,72)
      WRITE(NWRITE,1001) UPLEFT,(UP,JJ=1,102),UPRIGHT
      DO 18 KY=1,NPOS
          DO 7 K=1,NPOS
               IW(K)=IBLANK
               K3=K+3
               FOR(K3)=FALF
    7     CONTINUE
          DO 9 KJ=1,N
               IF(IXY(KJ,2).NE.KY) GO TO 9
               K=IXY(KJ,1)
               K3=K+3
               FOR(K3)=FINT
               IF(ITEM.EQ.0) GO TO 10
               IW(K)=IPRF(ITEM,KJ)
               GO TO 9
   10          CONTINUE
               IDP=KJ-(IPART-1)*100
               IW(K)=IDP
               IF(IDP.EQ.100) IW(K)=0
               IF(IDP.GE.1.AND.IDP.LE.100) GO TO 9
               IW(K)=ISTAR
               FOR(K3)=FALF
    9     CONTINUE
C
C
          IF(KY.EQ.1) THEN
               WRITE(NWRITE,FOR) I100, LEFT, IW, RIGHT
          ELSE IF(KY.EQ.(NPOS+1)/2) THEN
               WRITE(NWRITE,FOR) I50, LEFT, IW, RIGHT
          ELSE IF(KY.EQ.NPOS) THEN
               WRITE(NWRITE,FOR) I0, LEFT, IW, RIGHT
          ELSE
               WRITE(NWRITE,FOR) IBL, LEFT, IW, RIGHT
          END IF
C
   18 CONTINUE
      WRITE(NWRITE,1001) BOTTMLEFT,(BOTTM,JJ=1,102),BOTTMRIGHT
      WRITE(NWRITE,1222)
C
      RETURN
C
   72 FORMAT(/)
C
C  THE FOLLOWING FORMATS ARE
C  AVAILABLE FOR 51 POSITIONS
C
 1001 FORMAT(8X,104A1)
 1222 FORMAT(2(10X,1H.,49X,1H.,49X,1H.,/),
     $10X,1H0,48X,2H50,48X,3H100)
C
      END

      SUBROUTINE PLSCRN(SOL,IPRF,IXY,IPART,NV,N)

C  THIS SUB. PLOTS FOR SOLUTION SOL for display on a screen and .SCR file
C  IXY IS A WORKING AREA
C  THE INPUT COORDINATES SOL(.,1) (FIRST AXIS)
C  AND SOL(.,J) (SECOND AXIS) HAVE TO LIE
C  BETWEEN 0. AND 100.

      INTEGER*2 IPART,NV,N
      INTEGER*2 IPRF(NV,N), IXY(N,2)
      REAL      SOL(N,2)
      INTEGER*2 IW(25)
C
      COMMON/BOXSTRNG/UP,BOTTM,LEFT,RIGHT,
     $                UPLEFT,UPRIGHT,BOTTMLEFT,BOTTMRIGHT
      COMMON /WCHAR/ FOR,DUMMY
      COMMON/VARINT/INTERN
      COMMON/REJECT/ LOWFRQ, IFRQONE
C
      CHARACTER*4 FOR(32)
      CHARACTER*152 DUMMY(2)
      CHARACTER*1 UP,BOTTM,LEFT,RIGHT,
     $            UPLEFT,UPRIGHT,BOTTMLEFT,BOTTMRIGHT
CY      CHARACTER*4 F1,F56,F3,SK8,BLANK,FALF,FINT,F21,F22,F24
      CHARACTER*4 F1,F56,F3,BLANK,FALF,FINT,F21,F22,F24
C      CHARACTER*5 I100,I50,I0,IBL
      INTEGER*2   IBLANK, ISTAR, ITEMP
      LOGICAL     TMPOPEN
C
      INTEGER*2 K,NCOOR,NROW,NCOL,NCOL2,NFOR,LL,KJ,IDP,IBASE,JEND,JINT
C
      DATA F1,F56,F3/4H(1X     ,4H)       ,4H,A1  /
      DATA F21, F22, F24 /4H,I3,  , 4H2X,  , 4HI2)  /
      DATA BLANK,FALF,FINT/4H        ,4H,A2   ,4H,I2      /
      DATA IBLANK,ISTAR/2H      ,2H *    /
C      DATA I100,I50,I0,IBL/5H100.. ,5H 50..  ,5H  0..  ,5H       /
C
C **********************************************************************
C
C  THIS PLOT IS AVAILABLE FOR 51
C  POSITIONS IN EACH AXIS SINCE THE
C  COORDINATES GO FROM 0./2 TO 100./2
C
C  FOR THE SCREEN, USE A 23 ROW 50 COLUMN PLOT.
C
C     FIRSTLY, OPEN THE SCREEN FILE
C
      ITEMP = 21
      OPEN (ITEMP, FILE='POSAC.SCR', ACCESS='SEQUENTIAL',
     $             FORM='FORMATTED', ERR=100)
      TMPOPEN = .TRUE.
      GOTO 101
 100  TMPOPEN = .FALSE.
      WRITE (*,*) ' ** Cannot open screen plot file **'
 101  CONTINUE
C
      NCOOR=24
      NROW=NCOOR-1
      NCOL=NCOOR+1
      NCOL2=NCOL+NCOL
      NFOR=2+5+NCOL
C
      JEND = N
      IF (JEND .GT. 24) JEND = 24
      JINT = INTERN
      IF (JINT .GT. 11) JINT = 11
C
C  CLEAR FORMAT ARRAY
C      DO 1 K=1,NFOR
C          FOR(K)=BLANK
C    1 CONTINUE
C
      FOR(1)=F1
      FOR(2)=F3
      FOR(NFOR-4)=F3
      FOR(NFOR-3)=F21
      FOR(NFOR-2)=F22
      WRITE (FOR(NFOR-1),'(I4)') JINT
      FOR(NFOR)=F24
C
C  POINT COORDINATES ON FIRST AXIS
      DO 3 K=1,N
          IXY(K,1)=.24*SOL(K,1)+1.5
    3 CONTINUE
C
C  POINT COORDINATES ON SECOND AXIS
      DO 71 K=1,N
          LL=.22*SOL(K,2)+1.5
          IXY(K,2)=NROW+1-LL
   71 CONTINUE
C
      IBASE = (IPART-1) * 100
C
      WRITE(*,72) CHAR (7), CHAR (7)
      IF (IFRQONE .EQ. 1) THEN
          WRITE(*,1001) UPLEFT,(UP,JJ=1,NCOL2),UPRIGHT,
     $                             '     STRUCTURAL POSAC'
          IF (TMPOPEN) WRITE(ITEMP,1001) UPLEFT,(UP,JJ=1,NCOL2),UPRIGHT,
     $                             '     STRUCTURAL POSAC'
      ELSE
          WRITE(*,1001) UPLEFT,(UP,JJ=1,NCOL2),UPRIGHT,
     $                             '      POSAC SOLUTION'
          IF (TMPOPEN) WRITE(ITEMP,1001) UPLEFT,(UP,JJ=1,NCOL2),UPRIGHT,
     $                                 '      POSAC SOLUTION'
      END IF
      DO 18 KY=1,NROW
          DO 7 K=1,NCOL
               IW(K)=IBLANK
               FOR(K+2)=FALF
    7     CONTINUE
          DO 9 KJ=1,N
               IF(IXY(KJ,2).NE.KY) GO TO 9
               K=IXY(KJ,1)
               IDP=KJ - IBASE
               IF (IDP.EQ.100) THEN
                    IW(K)=0
                    FOR(K+2)=FINT
               ELSE IF(IDP.GE.1.AND.IDP.LE.100) THEN
                    IW(K)=IDP
                    FOR(K+2)=FINT
               ELSE
                    IW(K)=ISTAR
               END IF
    9     CONTINUE
C
          IF (KY .LE. JEND) THEN
               WRITE(*,FOR) LEFT, IW, RIGHT, KY, (IPRF(K,KY),K=1,JINT)
               IF (TMPOPEN) WRITE(ITEMP,FOR) LEFT, IW, RIGHT,
     $                                       KY, (IPRF(K,KY),K=1,JINT)
          ELSE
               WRITE(*,FOR) LEFT, IW, RIGHT
               IF (TMPOPEN) WRITE(ITEMP,FOR) LEFT, IW, RIGHT
          END IF
C
   18 CONTINUE
      WRITE(*,1001) BOTTMLEFT,(BOTTM,JJ=1,NCOL2),BOTTMRIGHT
      IF (TMPOPEN) WRITE(ITEMP,1001) BOTTMLEFT,(BOTTM,JJ=1,NCOL2),
     $                               BOTTMRIGHT
C      WRITE(*,1222)
C
      IF (TMPOPEN) CLOSE (ITEMP)
      RETURN
C
   72 FORMAT(1X,2A1)
C
C  THE FOLLOWING FORMATS ARE
C  AVAILABLE FOR 51 POSITIONS
C
 1001 FORMAT(1X,104A)
C 1222 FORMAT(2(3X,1H.,49X,1H.,49X,1H.,/),
C     $10X,1H0,48X,2H50,48X,3H100)
C
      END

      SUBROUTINE LEGEND
C
      COMMON/IO/NTAPE,NREAD,NWRITE,NSCR
      COMMON/FF/FORMFEED
      CHARACTER*1 FORMFEED
C
      WRITE(NWRITE,100) FORMFEED
  100 FORMAT(A1,20X,38HLEGEND ON CODES USED IN TRAIT DIAGRAMS,
     $//,1X,55HIN THE ABSOLUTE TRAIT DIAGRAMS THE FOLLOWING CODES ARE ,
     $55HUSED FOR THE PROPORTIONS OF SUBJECTS WITH THE SPECIFIED,
     $/,1X,44HTRAIT (AMONG THOSE WITH IDENTICAL PROFILE) .,//,20X,
     $8HO      0,/,20X,13HA   ( 0 ,1/5],/,20X,13HB   (1/5,2/5],/,
     $20X,13HC   (2/5,3/5),/,20X,13HD   [3/5,4/5),/,20X,
     $13HE   [4/5, 1 ),/,20X,8HI      1)
      WRITE(NWRITE,200)
  200 FORMAT(////,1X,45HIN THE RELATIVE TRAIT DIAGRAMS ANOTHER CODES ,
     $37HARE USED WITH THE FOLLOWING MEANING :,//,20X,4HH   ,
     $42HPROPORTION OF TRAIT IN PROFILE HIGHER THAN,/,24X,
     $56HPROPORTION OF TRAIT IN POPULATION BY MORE THAN 5 PERCENT,
     $//,20X,4HA   ,37HPROPORTION OF TRAIT IN PROFILE EQUALS,/,24X,
     $50HPROPORTION OF TRAIT IN POPULATION + OR - 5 PERCENT,//,20X,
     $4HL   ,41HPROPORTION OF TRAIT IN PROFILE LOWER THAN,/,24X,
     $56HPROPORTION OF TRAIT IN POPULATION BY MORE THAN 5 PERCENT)
      RETURN
      END

      SUBROUTINE SRCMAP(ISCO,IPRF,NV)
C
      COMMON/IO/NTAPE,NREAD,NWRITE,NSCR
      COMMON/VARINT/INTERN
      COMMON/CC/ISMN,ISMX,IEND
C
      INTEGER*2 ISMN,ISMX,IEND
      INTEGER*2 NV, ISCO(IEND),IPRF(NV,IEND)
C
C  SAVES SCORES AND INTERNAL PROF. ON UNIT NSCR
C
      DO 10 I=1,IEND
          WRITE(NSCR) ISCO(I),(IPRF(J,I),J=1,INTERN)
   10 CONTINUE
C
      RETURN
      END

